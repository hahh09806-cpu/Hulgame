<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÅ Multiplayer Car Racing - Create & Join Rooms</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            background: linear-gradient(135deg, #0a0f1e, #1a1f2e);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-wrapper {
            max-width: 1200px;
            width: 100%;
        }

        /* Menu Screen */
        .menu-screen {
            background: #16213e;
            border-radius: 20px;
            padding: 40px;
            border: 3px solid #e94560;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
            text-align: center;
        }

        .menu-screen h1 {
            color: #e94560;
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
        }

        .menu-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 40px 0;
        }

        .menu-btn {
            background: #0f3460;
            color: white;
            border: 2px solid #e94560;
            padding: 20px 40px;
            font-size: 1.5em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .menu-btn:hover {
            background: #e94560;
            transform: scale(1.05);
        }

        .room-input {
            background: #0f3460;
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .room-input input {
            background: #1a1f2e;
            border: 2px solid #e94560;
            padding: 15px 25px;
            font-size: 1.2em;
            color: white;
            border-radius: 5px;
            width: 300px;
            margin-right: 10px;
        }

        .room-input input::placeholder {
            color: #666;
        }

        .action-btn {
            background: #e94560;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 5px;
            cursor: pointer;
            border-bottom: 4px solid #8b2c3e;
            font-weight: bold;
        }

        .action-btn:active {
            transform: translateY(4px);
            border-bottom-width: 0;
        }

        /* Game Screen */
        .game-screen {
            background: #16213e;
            border-radius: 20px;
            padding: 25px;
            border: 3px solid #e94560;
            display: none;
        }

        .room-info {
            background: #0f3460;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .room-code {
            background: #1a1f2e;
            padding: 10px 20px;
            border-radius: 5px;
            border-left: 3px solid #e94560;
            font-size: 1.3em;
            font-weight: bold;
        }

        .players-list {
            display: flex;
            gap: 20px;
        }

        .player-badge {
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
        }

        .player1 { background: #e94560; }
        .player2 { background: #4ecdc4; }

        .game-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .race-track {
            flex: 2;
            min-width: 600px;
        }

        canvas {
            background: #1e272e;
            border-radius: 10px;
            border: 3px solid #e94560;
            width: 100%;
            height: auto;
        }

        .players-panel {
            flex: 1;
            min-width: 250px;
            background: #0f3460;
            border-radius: 10px;
            padding: 20px;
            color: white;
        }

        .player-card {
            background: #1a1f2e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }

        .player-card.p1 { border-color: #e94560; }
        .player-card.p2 { border-color: #4ecdc4; }

        .player-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .player-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
        }

        .controls-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e94560;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .ctrl-btn {
            background: #1a1f2e;
            color: white;
            border: 2px solid #e94560;
            padding: 15px;
            border-radius: 5px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
        }

        .ctrl-btn:active {
            background: #e94560;
        }

        .waiting-message {
            text-align: center;
            color: #e94560;
            font-size: 1.2em;
            margin: 20px 0;
        }

        .back-btn {
            background: #e94560;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }
            
            .race-track {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <!-- Menu Screen -->
        <div id="menuScreen" class="menu-screen">
            <h1>üèÅ MULTIPLAYER RACING</h1>
            
            <div class="menu-buttons">
                <button class="menu-btn" onclick="showCreateRoom()">üéÆ CREATE ROOM</button>
                <button class="menu-btn" onclick="showJoinRoom()">üöó JOIN ROOM</button>
            </div>

            <div id="createRoomSection" class="room-input" style="display: none;">
                <h2 style="color: white; margin-bottom: 20px;">Create New Room</h2>
                <input type="text" id="playerNameCreate" placeholder="Your Name" value="Player 1">
                <button class="action-btn" onclick="createRoom()">CREATE ROOM</button>
            </div>

            <div id="joinRoomSection" class="room-input" style="display: none;">
                <h2 style="color: white; margin-bottom: 20px;">Join Room</h2>
                <input type="text" id="roomCode" placeholder="Room Code">
                <input type="text" id="playerNameJoin" placeholder="Your Name" value="Player 2" style="margin-top: 10px;">
                <button class="action-btn" onclick="joinRoom()" style="margin-top: 10px;">JOIN ROOM</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="game-screen">
            <div class="room-info">
                <div>
                    <span style="color: #a0a0a0;">Room: </span>
                    <span class="room-code" id="currentRoomCode">ABC123</span>
                </div>
                <div class="players-list" id="playersList">
                    <span class="player-badge player1" id="player1Status">üë§ Player 1</span>
                    <span class="player-badge player2" id="player2Status">üë§ Player 2</span>
                </div>
                <button class="back-btn" onclick="leaveRoom()">üö™ LEAVE ROOM</button>
            </div>

            <div class="game-container">
                <div class="race-track">
                    <canvas id="gameCanvas" width="600" height="500"></canvas>
                    
                    <div id="waitingMessage" class="waiting-message" style="display: none;">
                        ‚è≥ Waiting for opponent to join...
                    </div>
                </div>

                <div class="players-panel">
                    <h2 style="color: #e94560; margin-bottom: 20px;">RACE STATUS</h2>
                    
                    <div id="player1Card" class="player-card p1">
                        <div class="player-name" id="player1Name">Player 1</div>
                        <div class="player-stats">
                            <div>Speed: <span id="player1Speed">0</span></div>
                            <div>Laps: <span id="player1Laps">0</span></div>
                        </div>
                    </div>

                    <div id="player2Card" class="player-card p2" style="opacity: 0.5;">
                        <div class="player-name" id="player2Name">Waiting...</div>
                        <div class="player-stats">
                            <div>Speed: <span id="player2Speed">0</span></div>
                            <div>Laps: <span id="player2Laps">0</span></div>
                        </div>
                    </div>

                    <div class="controls-section">
                        <h3 style="color: #e94560;">CONTROLS</h3>
                        <div class="control-buttons">
                            <button class="ctrl-btn" id="upBtn" ontouchstart="moveCar('up')" ontouchend="stopCar('up')" onmousedown="moveCar('up')" onmouseup="stopCar('up')">‚Üë</button>
                            <button class="ctrl-btn" id="downBtn" ontouchstart="moveCar('down')" ontouchend="stopCar('down')" onmousedown="moveCar('down')" onmouseup="stopCar('down')">‚Üì</button>
                            <button class="ctrl-btn" id="leftBtn" ontouchstart="moveCar('left')" ontouchend="stopCar('left')" onmousedown="moveCar('left')" onmouseup="stopCar('left')">‚Üê</button>
                            <button class="ctrl-btn" id="rightBtn" ontouchstart="moveCar('right')" ontouchend="stopCar('right')" onmousedown="moveCar('right')" onmouseup="stopCar('right')">‚Üí</button>
                            <button class="ctrl-btn" id="nitroBtn" style="grid-column: span 3;" onclick="useNitro()">‚ö° NITRO</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBkS_3sQ9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q9", // You'll need to replace this
            authDomain: "multiplayer-racing.firebaseapp.com",
            databaseURL: "https://multiplayer-racing-default-rtdb.firebaseio.com",
            projectId: "multiplayer-racing",
            storageBucket: "multiplayer-racing.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abc123def456"
        };

        // Initialize Firebase (you'll need to create your own Firebase project)
        // For now, we'll use a mock implementation for demonstration
        let firebaseInitialized = false;
        
        // Mock database for demonstration
        const mockDB = {
            rooms: {}
        };

        // Game variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let currentPlayer = null;
        let currentRoom = null;
        let playerName = '';
        let roomCode = '';
        
        // Car objects
        const cars = {
            player1: {
                x: 150,
                y: 250,
                width: 40,
                height: 60,
                color: '#e94560',
                speed: 5,
                nitroSpeed: 8,
                moving: { up: false, down: false, left: false, right: false },
                laps: 0,
                checkpoint: false
            },
            player2: {
                x: 400,
                y: 250,
                width: 40,
                height: 60,
                color: '#4ecdc4',
                speed: 5,
                nitroSpeed: 8,
                moving: { up: false, down: false, left: false, right: false },
                laps: 0,
                checkpoint: false
            }
        };

        let gameRunning = true;
        let frameCount = 0;
        let nitroActive = false;
        let nitroDuration = 0;
        let myPlayerId = null;

        // Track boundaries (for lap counting)
        const startLine = { x: 0, y: 100, width: 600, height: 10 };

        // UI Functions
        function showCreateRoom() {
            document.getElementById('createRoomSection').style.display = 'block';
            document.getElementById('joinRoomSection').style.display = 'none';
        }

        function showJoinRoom() {
            document.getElementById('joinRoomSection').style.display = 'block';
            document.getElementById('createRoomSection').style.display = 'none';
        }

        function createRoom() {
            playerName = document.getElementById('playerNameCreate').value || 'Player 1';
            roomCode = generateRoomCode();
            
            currentPlayer = 'player1';
            myPlayerId = 'player1';
            
            // Initialize room in mock database
            mockDB.rooms[roomCode] = {
                player1: { name: playerName, connected: true, car: cars.player1 },
                player2: { name: 'Waiting...', connected: false, car: cars.player2 },
                createdAt: Date.now()
            };
            
            startGame();
        }

        function joinRoom() {
            const inputCode = document.getElementById('roomCode').value.toUpperCase();
            playerName = document.getElementById('playerNameJoin').value || 'Player 2';
            
            // Check if room exists in mock database
            if (mockDB.rooms[inputCode]) {
                roomCode = inputCode;
                currentPlayer = 'player2';
                myPlayerId = 'player2';
                
                // Update room
                mockDB.rooms[roomCode].player2 = { name: playerName, connected: true, car: cars.player2 };
                
                startGame();
            } else {
                alert('Room not found!');
            }
        }

        function generateRoomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function startGame() {
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            document.getElementById('currentRoomCode').textContent = roomCode;
            document.getElementById('player1Name').textContent = mockDB.rooms[roomCode].player1.name;
            
            if (mockDB.rooms[roomCode].player2.connected) {
                document.getElementById('player2Name').textContent = mockDB.rooms[roomCode].player2.name;
                document.getElementById('player2Card').style.opacity = 1;
            } else {
                document.getElementById('waitingMessage').style.display = 'block';
            }
            
            // Start game loop
            gameLoop();
        }

        function leaveRoom() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('menuScreen').style.display = 'block';
            
            // Clean up room
            if (roomCode && mockDB.rooms[roomCode]) {
                delete mockDB.rooms[roomCode];
            }
            
            currentRoom = null;
            currentPlayer = null;
        }

        // Car movement
        function moveCar(direction) {
            if (!currentPlayer || !gameRunning) return;
            
            cars[currentPlayer].moving[direction] = true;
            
            // Update other player in mock DB
            if (mockDB.rooms[roomCode]) {
                mockDB.rooms[roomCode][currentPlayer].car = cars[currentPlayer];
            }
        }

        function stopCar(direction) {
            if (!currentPlayer) return;
            cars[currentPlayer].moving[direction] = false;
        }

        function useNitro() {
            if (!currentPlayer || !gameRunning) return;
            
            nitroActive = true;
            nitroDuration = 30;
            
            // Visual feedback
            document.getElementById('nitroBtn').style.background = '#e94560';
            setTimeout(() => {
                document.getElementById('nitroBtn').style.background = '#1a1f2e';
            }, 300);
        }

        // Update car position
        function updateCar(car) {
            const currentSpeed = nitroActive && car === cars[currentPlayer] ? car.nitroSpeed : car.speed;
            
            if (car.moving.up && car.y > 0) car.y -= currentSpeed;
            if (car.moving.down && car.y < canvas.height - car.height) car.y += currentSpeed;
            if (car.moving.left && car.x > 0) car.x -= currentSpeed;
            if (car.moving.right && car.x < canvas.width - car.width) car.x += currentSpeed;
            
            // Check lap (crossing start line)
            if (car.y < 110 && car.y > 90 && !car.checkpoint) {
                car.checkpoint = true;
            }
            if (car.checkpoint && car.y > 110) {
                car.laps++;
                car.checkpoint = false;
                
                // Update lap display
                if (car === cars.player1) {
                    document.getElementById('player1Laps').textContent = car.laps;
                } else {
                    document.getElementById('player2Laps').textContent = car.laps;
                }
            }
        }

        // Drawing functions
        function drawTrack() {
            // Road
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Lane markings
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 3;
            ctx.setLineDash([20, 30]);
            
            for (let i = 0; i < canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            
            ctx.setLineDash([]);
            
            // Start line
            ctx.fillStyle = '#ffff00';
            ctx.fillRect(0, 100, canvas.width, 5);
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('START/FINISH', 250, 90);
        }

        function drawCar(car) {
            ctx.save();
            
            // Car body
            ctx.fillStyle = car.color;
            ctx.shadowColor = car.color;
            ctx.shadowBlur = 15;
            ctx.fillRect(car.x, car.y, car.width, car.height);
            
            // Windows
            ctx.fillStyle = '#1e272e';
            ctx.shadowBlur = 5;
            ctx.fillRect(car.x + 5, car.y + 10, car.width - 10, 15);
 
